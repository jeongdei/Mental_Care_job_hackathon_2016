<%@ page language="java" contentType="text/html; charset=EUC-KR"
    pageEncoding="EUC-KR"%>
<%@page import="java.io.*,java.util.Date" %>
<%@page import="java.net.*" %>
<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=EUC-KR">
<title>Insert title here</title>
</head>
<body>
	<h2>글쓰기</h2>
	<%
		request.setCharacterEncoding("euc-kr");
		String name = request.getParameter("NAME");
		String title = request.getParameter("TITLE");
		String content = request.getParameter("CONTENT");
		
		Date date = new Date();
		Long time = date.getTime();
		String filename = time+".txt";
		
		PrintWriter writer = null;
		
		try{
			String dir=application.getRealPath("C:\\Users\\Myung Jun\\Desktop");
			String filePath = dir +"/"+filename;
			
			writer = new PrintWriter(filePath);
			writer.printf("제목 : %s %n",title);
			writer.printf("글쓴이 : %s %n", name);
			writer.println(content);
			
			out.println("저장됨");
		}catch (IOException e){
			out.println("데이터 쓸수 없음");
		}
		finally {
			try {
				writer.close();
			}catch (Exception e) {
				
			}
		}
	%>
	
	<%
	 // 파일생성
    File objFile = new File("C:\\test.txt");

    if(objFile.exists()) objFile.delete();

    if(objFile.createNewFile())
    {
        BufferedWriter objBW = new BufferedWriter(new FileWriter(objFile));
        objBW.write("Hello File\r\n");
        objBW.close();
    }

    // 파일 다운로드
    response.setContentType("application/x-msdownload");
    
    String strFileName = URLEncoder.encode(new String(objFile.getName().getBytes("8859_1"), "euc-kr"), "UTF-8");
    response.setHeader("Content-Disposition", "attachment;filename=" + strFileName + ";");
    
    int nRead = 0;
    byte btReadByte[] = new byte[(int)objFile.length()];

    if(objFile.length() > 0 && objFile.isFile())
    {
        BufferedInputStream objBIS = new BufferedInputStream(new FileInputStream(objFile));
        BufferedOutputStream objBOS = new BufferedOutputStream(response.getOutputStream());

        while((nRead = objBIS.read(btReadByte)) != -1)
            objBOS.write(btReadByte, 0, nRead);
    
        objBOS.flush();
        objBOS.close();
        objBIS.close();
    }
	%>

</body>
</html>